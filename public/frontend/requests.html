<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Solicitudes</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="css/exact-style.css" rel="stylesheet"><script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script></head><body x-data="requestsPage()" x-init="load()"><div class="header"><img src="assets/logo1.png" class="logo"><img src="assets/logo2.png" class="logo"><div style="margin-left:auto"><button class="btn btn-outline-dark" @click="logout()">Salir</button></div></div><div class="container-fluid"><div class="row"><div class="col-2"><div class="sidebar"><a href="dashboard.html">Inicio</a><a href="users.html">Usuarios</a><a href="products.html">Productos</a><a href="reports.html">Reportes</a></div></div><div class="col-9"><div class="card-panel"><h3>Solicitudes</h3><div class="mb-3"><button class="btn btn-primary me-2" @click="new('prestamo')">Préstamo</button><button class="btn btn-secondary" @click="new('salida')">Salida</button></div><table class="table table-soft"><thead><tr><th>ID</th><th>Folio</th><th>Tipo</th><th>Solicitante</th><th>Estado</th><th>Acción</th></tr></thead><tbody><template x-for="r in requests" :key="r.id"><tr><td x-text="r.id"></td><td x-text="r.folio"></td><td x-text="r.type"></td><td x-text="r.solicitante"></td><td x-text="r.status"></td><td><button class="btn btn-sm btn-info" @click="view(r)">Ver</button><template x-if="role==='coordinator'"><button class="btn btn-sm btn-danger" @click="del(r)">Eliminar</button></template></td></tr></template></tbody></table></div></div></div></div><script src="js/app.js"></script><script>function requestsPage(){return {role:'encargado',requests:[],products:[],modal:false,form:{items:[]},newItem:{product_id:'',quantity:1},async load(){const r=await apiFetch('/requests','GET');if(r.ok)this.requests=r.data;const p=await apiFetch('/products','GET');if(p.ok)this.products=p.data;},logout(){localStorage.removeItem('token');window.location='index.html';},new(type){this.form={type:type,items:[],solicitante:'',return_date:null};this.modal=true;},addItem(){const p=this.products.find(x=>x.id==this.newItem.product_id);if(!p)return;this.form.items.push({product_id:p.id,name:p.name,quantity:this.newItem.quantity});this.newItem={product_id:'',quantity:1};},async save(){const body={type:this.form.type,solicitante:this.form.solicitante,items:this.form.items,return_date:this.form.return_date};await apiFetch('/requests','POST',body);this.modal=false;this.load();},view(r){alert(JSON.stringify(r));},async del(r){if(!confirm('Eliminar?'))return;await apiFetch('/requests/'+r.id,'DELETE');this.load();}}}</script></body></html>