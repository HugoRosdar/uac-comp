<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>UAC - Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="css/exact-style.css" rel="stylesheet">
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

</head>
<body>
<div style="max-width:520px;margin:70px auto;">
  <div class="card-panel">
    <h3 style="color:var(--navy)">Inicio de sesión</h3>
    <form x-data="login()" @submit.prevent="proceed">
      <div class="mb-3">
        <label class="small-muted">Usuario / Número</label>
        <input class="form-control input-soft" x-model="user" required>
      </div>
      <div class="mb-3" x-show="stage==='password'">
        <label class="small-muted">Contraseña</label>
        <input type="password" class="form-control input-soft" x-model="password" required>
      </div>
      <div class="d-flex justify-content-end">
        <button class="btn-primary-yellow">Continuar</button>
      </div>
      <div class="mt-2 text-danger" x-text="error"></div>
    </form>
  </div>
</div>
<script src="js/app.js"></script>
<script>
function login(){ return {
  user:'', password:'', stage:'check', error:'',
  async proceed(){
    this.error='';
    if(this.stage==='check'){
      const r = await apiFetch('/auth/check-account','POST',{user:this.user});
      if(r.ok && r.data.exists) this.stage='password'; else this.error='Cuenta no encontrada';
    } else {
      const r = await apiFetch('/auth/login','POST',{user:this.user,password:this.password});
      if(r.ok){ localStorage.setItem('token', r.data.token); window.location='dashboard.html'; } else this.error=r.data.message||'Credenciales inválidas';
    }
  }
};}
</script>
</body>
</html>
