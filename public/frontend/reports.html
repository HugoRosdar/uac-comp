<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Reportes</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="css/exact-style.css" rel="stylesheet"><script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script></head><body x-data="reportsPage()" x-init="load()"><div class="header"><img src="assets/logo1.png" class="logo"><img src="assets/logo2.png" class="logo"><div style="margin-left:auto"><button class="btn btn-outline-dark" @click="logout()">Salir</button></div></div><div class="container-fluid"><div class="row"><div class="col-2"><div class="sidebar"><a href="dashboard.html">Inicio</a><a href="users.html">Usuarios</a><a href="products.html">Productos</a><a href="requests.html">Solicitudes</a></div></div><div class="col-9"><div class="card-panel"><h3>Reportes</h3><div class="mb-3"><button class="btn btn-primary me-2" @click="tab='movements'">Movimientos</button><button class="btn btn-secondary" @click="tab='requests'">Solicitudes</button></div><div x-show="tab=='movements'"><div class="d-flex justify-content-between"><h5>Movimientos</h5><div><button class="btn btn-outline-primary" @click="exportMovements()">Exportar PDF</button></div></div><table class="table table-soft"><thead><tr><th>ID</th><th>Usuario</th><th>Acción</th><th>Detalles</th><th>Fecha</th></tr></thead><tbody><template x-for="m in movements" :key="m.id"><tr><td x-text="m.id"></td><td x-text="m.user"></td><td x-text="m.action"></td><td x-text="m.details"></td><td x-text="m.created_at"></td></tr></template></tbody></table><div class="d-flex justify-content-between"><button class="btn" @click="prev()">Anterior</button><div>Página <span x-text="page"></span></div><button class="btn" @click="next()">Siguiente</button></div></div><div x-show="tab=='requests'"><div class="d-flex justify-content-between"><h5>Solicitudes</h5><div><button class="btn btn-outline-primary" @click="exportRequests()">Exportar PDF</button></div></div><table class="table table-soft"><thead><tr><th>ID</th><th>Folio</th><th>Tipo</th><th>Solicitante</th><th>Fecha</th></tr></thead><tbody><template x-for="r in reqs" :key="r.id"><tr><td x-text="r.id"></td><td x-text="r.folio"></td><td x-text="r.type"></td><td x-text="r.solicitante"></td><td x-text="r.requested_at"></td></tr></template></tbody></table></div></div></div></div></div><script src="js/app.js"></script><script>function reportsPage(){return {tab:'movements',page:1,movements:[],reqs:[],async load(){const r=await apiFetch('/movements?page='+this.page,'GET');if(r.ok)this.movements=r.data.data;const s=await apiFetch('/requests/history','GET');if(s.ok)this.reqs=s.data;},logout(){localStorage.removeItem('token');window.location='index.html';},prev(){if(this.page>1){this.page--;this.load();}},next(){this.page++;this.load();},async exportMovements(){const res=await fetch('/api/reports/movements?page='+this.page,{headers:{'Authorization':'Bearer '+localStorage.getItem('token')}});if(res.ok){const blob=await res.blob();downloadBlob('movimientos_page_'+this.page+'.pdf',blob);}else alert('Error exportando');},async exportRequests(){const res=await fetch('/api/reports/requests',{headers:{'Authorization':'Bearer '+localStorage.getItem('token')}});if(res.ok){const blob=await res.blob();downloadBlob('solicitudes.pdf',blob);}else alert('Error exportando');}}}</script></body></html>