<!doctype html>
<html lang="es">
    <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Productos</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/exact-style.css" rel="stylesheet">
        <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    </head>
    <body x-data="productsPage()" x-init="load()">
        <div class="header">
            <img src="assets/logo1.png" class="logo">
            <img src="assets/logo2.png" class="logo">
            <div style="margin-left:auto">
                <button class="btn btn-outline-dark" @click="logout()">Salir</button>
            </div></div><div class="container-fluid"><div class="row">
                <div class="col-2"><div class="sidebar">
                    <a href="dashboard.html">Inicio</a><a href="users.html">Usuarios</a>
                    <a href="requests.html">Solicitudes</a>
                    <a href="reports.html">Reportes</a></div></div>

                    <div class="col-9"><div class="card-panel">
                        <div class="d-flex justify-content-between">
                            <h3>Productos</h3><button class="btn btn-primary" @click="openNew()">Agregar</button>
            </div>
            <table class="table table-soft mt-3">
                <thead><tr><th>ID</th><th>Nombre</th><th>Descripción</th><th>Categoría</th><th>Stock</th><th>Acción</th></tr></thead>
                <tbody><template x-for="p in products" :key="p.id"><tr :class="{'table-danger':p.quantity==0}"><td x-text="p.id"></td><td x-text="p.name"></td><td x-text="p.description"></td><td x-text="p.category_name"></td><td x-text="p.quantity"></td><td><button class="btn btn-sm btn-secondary" @click="edit(p)">Editar</button><button class="btn btn-sm btn-danger" @click="remove(p.id)">Eliminar</button></td></tr></template></tbody></table></div></div></div></div><script src="js/app.js"></script><script>function productsPage(){return {products:[],categories:[],modal:false,form:{},async load(){const r=await apiFetch('/products','GET');if(r.ok)this.products=r.data;const c=await apiFetch('/categories','GET');if(c.ok)this.categories=c.data;},logout(){localStorage.removeItem('token');window.location='index.html';},openNew(){this.form={};this.modal=true;},edit(p){this.form=Object.assign({},p);this.modal=true;},async save(){if(this.form.id)await apiFetch('/products/'+this.form.id,'PUT',this.form);else await apiFetch('/products','POST',this.form);this.modal=false;this.load();},async remove(id){if(!confirm('Eliminar producto?'))return;await apiFetch('/products/'+id,'DELETE');this.load();}}}</script></body></html>